# JVM Monitor Agent(JMA)

## Introduction
The JVM Monitoring Agent(JMA) is a WSO2 DAS based JVM system metric usage monitoring tool which is capable of publishing those data into WSO2 DAS.

The types of usage data collected are;

1. Memory Usage Data (Heap and Non Heap)

2. CPU Load Percentages (JVM process and System)

3. Garbage Collection Logs (GC Type, Memory parameters before and after GC)

## Prerequisites

- [WSO2 DAS 3.1.0](http://wso2.com/products/data-analytics-server/) or later (Using lower version of DAS may required WSO2 ML and WSO2 CEP products)
- [WSO2 Anomaly Detection DAS Configuration Resources](https://github.com/wso2-incubator/automatic-anomaly-detection/tree/master/wso2-das)

## Installation

### 1) Build JMA

  1. **JVM Monitor Agent** is built using Apache Maven. To build JMA, run:
       ``` 
        mvn clean install
       ```
        
  2. Unzip the zip generated by maven build
    
### 2) Configuring **JVM Monitoring Agent**
  
  1. **Open ```<JMA_HOME>/bin/jma.properties```**
  
  2. **Configure DAS publisher**
    
    Change the following DAS publisher cofigurations in ```jma.properties``` in order to publish JVM monitoring data into the DAS
  
      ```
      jma.das.address = --Enter DAS IP adress--
      jma.das.username = --Enter DAS username--
      jma.das.password = --Enter DAS password--
      jma.das.thriftport = --Enter DAS Thrift port--
      jma.das.binaryport = --Enter DAS Binary port--
      ```
      
     Sample configurations would be:
     
     ```
      jma.das.address = 127.0.0.1
      jma.das.username = admin
      jma.das.password = admin
      jma.das.thriftport = 7611
      jma.das.binaryport = 9611
    ```
  3. **Cofigure JVM Monitor Agent**
     
      1. **Monitoring remote JVM using JMX URL**
    
           Change the following parameters of ```jma.properties``` in order to configure remote monitoring using JMX URL
           
            jma.target.remote_monitoring = --Set this true to enable remote monitoring--
            jma.target.address = --Monitoring jmx server ip--
            jma.target.rmi_server_port= --Monitoring rmi server port--
            jma.target.rmi_registry_port = --Monitoring rmi registry port--
            jma.target.username = --Access role of the JMX service for authorization--
            jma.target.password = --Password of the access role for authentication-- 
            
           Sample configurations would be :
            
            jma.target.remote_monitoring = true
            jma.target.address = 192.168.02.02
            jma.target.rmi_server_port= 11111
            jma.target.rmi_registry_port = 9999
            jma.target.username = admin
            jma.target.password = admin
            
      2. **Monitoring local JVM using Process ID(PID)**
      
           Change the following parameters of ```jma.properties``` in order to configure local monitoring using PID
            
            jma.target.remote_monitoring = --Set remote monitoring false to disable remote monitoring--
            
            jma.target.is_pid = -- Set this true to enable PID local monitoring
            jma.target.pid = -- Enter the PID of targeted application/JVM
          
          
           Sample configurations would be :
           
            
            jma.target.remote_monitoring = false
            
            jma.target.is_pid = true
            jma.target.pid = 12331
           
      

### 3) Configure DAS using [**WSO2 Anomaly Detection DAS Configuration Resources**](https://github.com/wso2-incubator/automatic-anomaly-detection/tree/master/wso2-das)


## Deployment

1. [Run WSO2 DAS server](https://docs.wso2.com/display/DAS310/Running+the+Product)

2. Run JVM monitor agent by executing ```<JMA_HOME>/bin/jma.sh```


